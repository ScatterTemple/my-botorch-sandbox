# 水曜夜の記録
- 手法ごとの期待とのズレを算出する関数化を行った
- あと optuna の importance 計算も実装した。
- 一番きつい条件として、二次式・norm・10 sample で実施。

| 手法           | 結果          |
|--------------|-------------|
|ANOVA 1st 分析| 2.679±3.760|
|ANOVA 2nd 分析| nan±nan|
|Sobol 感度分析| 0.990±0.580|
|Morris 感度分析| 2.594±1.661|
|optuna importance| 1.710±0.832|
|ランダムフォレスト| 3.836±2.507|
|SHAPLEY絶対値平均| 2.792±3.520|

ANOVA 1st 分析 1.798±1.506
ANOVA 2nd 分析 nan±nan
Sobol 感度分析 1.086±0.678
Morris 感度分析 3.197±2.805
optuna importance 1.870±0.872
ランダムフォレスト 4.945±6.953
SHAPLEY絶対値平均 1.937±1.561

Sobol がよさそうだ。
optuna はランダムフォレストと同じはずで、
すごい非線形問題には強いかも。
morris がなんでこんなに悪いのかよくわからない。



# 日曜夜の記録

- サロゲートモデルで sobol, morris, shap を再実装した。
- サンプル数が少ないときにはどれもガタガタである。
- サンプル数を dim <= p + 1 となる最小の p に対し p ** 2 回
  にすると、sobol か moris が順番があっていて、他は影響度の
  大小も間違えていた。
- ということで、サロゲートモデル + sobol は悪くないかもね。
- でももうちょっと統計的に見ないとわかんないね。

**∴ 次やること**
- サンプリングに拘束をつける（拘束違反の場合は
  infeasible であるという情報は残しつつ、 
  出力数が基底数になるまでサンプリングは行う）
- 手法ごとの期待とのズレを算出する関数化を行う
- その関数を目的関数とし、サンプル数の小ささやサンプリング方法の
  キツさに大しても良いパフォーマンスを発揮できる手法を選定する
  - サンプル数を 3 水準くらい（極端に少ない、普通、十分に多い）
  - サンプリング手法は 2 * 2 水準
    - uniform / norm と 拘束あり / なし 


# 土曜夜の記録

- なんか一周回って線形回帰 + ANOVA でもいい気がしてきた。
- これを使ってる人も多いと思うから...
- 標準化偏回帰係数。直感的には意味がわかりやすい。
- sqrt 分散比も、まあ悪くないだろう。
- sqrt sobol index や morris がいい感じなのだが、 
  これらは莫大な数再サンプリングしているので、
  botorch でのサロゲートモデルとかと組み合わせる必要がある。
  - そのときにどれくらい精度が落ちちゃうかを調べる必要がある。
    - こちらも、サンプリングがまんべんないからという説は大いにある。
- shap は bar の値の出し方が分かったので plotly で実装
  しようと思えばできる状態になった。でも意外とメチャクチャな
  値が出てくる。beeswarm はそこそこ信頼できるんだけど... 
  - それも、サンプリングがまんべんないから、という説は大いにある。

**∴ 次やること**
- サロゲートモデルで sobol と morris を再実装。
- shap がランダムフォレストモデルを使いまわしていたので
  同じくサロゲートモデルにガウス過程回帰を使うよう変更。

夜中になったので今日はここまで。


# 土曜日昼の記録

- botorch をやめて、 shap か何かをやることにした。
- shap はなんか依存が難しいし、plotly では動かないので別のものを実装することにした。
- とりあえず、salib と statsmodels を試すところ。
- まえは、compare_methods_analysis_2 が最後だった気がする。
